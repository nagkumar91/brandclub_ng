{% extends "core_base.html" %}
{% load crispy_forms_tags %}
{% block store_details %}
{% endblock %}
{% block extra_css %}
    <style>
        .center-img     {
            margin: 0 auto;
            width: 80%;
        }
        .append-content a   {
            margin-left: 10px;
            margin-bottom: 25px;
        }
        .append-content {
            margin-bottom: 75px;
        }
        .qr-image{
            margin-bottom: 25px;
        }
        .my-brand-list{
            margin-bottom: 20px;
            display: none;
        }
    </style>
{% endblock %}
{% block brand_background %}{% endblock %}
{% load staticfiles %}
{% block content %}
    <div class="container">
        {% if content.authenticate_user %}
            <div class="form form-group">
                <h3>Fill this form to get the offer</h3>
                <div class="user_name_div">
                    <input type="text" name="user_name" id="user_name" placeholder="Your Name" class="form-control"/><br/>
                </div>
                <div class="email_div">
                    <input type="text" name="phone_number" id="phone_number" placeholder="Your phone number"
                           class="form-control"/>
                    <br/>
                    <input type="email" name="email" id="email_id" placeholder="Your email id" class="form-control"/><br/>
                </div>
                <input type="hidden" name="offer" id="offer" value="{{ content.id }}"/>
                <input type="button" value="Submit" onclick="validate_and_submit()"/>
            </div>
        {% endif %}
        <div class="offer">
            <div class="center-img">
                <img src="{{ content.file.url }}"
                     class="img-responsive"/>
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_js %}
    <script type="text/javascript" src="{% static 'js/offer_fullscreen.js' %}"></script>
    {% block logging %}
        <script>
            $(document).ready(function(){
                var user_unique_id = readCookie("user_unique_id");
                call_log({{ content.id }}, window.log_info.home_device_id, user_unique_id, "Offers Fullscreen", "page load", "");
            });
        </script>

    {% endblock %}
    {% if content.show_qr %}
        <div class="append-content">

        </div>
        <script>
        //check if user can redeem the code at this store
        var is_enabled_store = false;
        $.ajax({
            type: "GET",
            url: "/qr_valid_in_store/",
            dataType: 'json',
            success: function (data) {
                console.log(data);
                if (data['valid'] == false) {
                    var stores = data['stores'];
                    console.log(stores);
                    var list_html = '<div class="center-img"><a class="btn btn-primary" href="#" onclick="bclub_store_click();">Brandclub Stores</a><ul class="my-brand-list">';
                    for (i=0;i<stores.length;i++){
                        list_html += "<li>"+stores[i]+"</li>";
                        console.log(stores[i]);
                    }
                    list_html += "</ul></div>";
                    $(".append-content").append(list_html);
                }
            }
        });

        function bclub_store_click(){
            $(".my-brand-list").toggle();
        }

        //user can redeem the code
        setTimeout(function(){
            $.ajax({
                type: "GET",
                url: "/display_qr/",
                dataType: 'json',
                success: function (data) {
                    var qr_link = data['qr_link'];
                    $(".append-content").append('<div class="center-img"><img class="img-responsive qr-image" src="'+qr_link+'" /></div>');

                }
            });
        }, 250);

        </script>
    {% endif %}
{% endblock %}